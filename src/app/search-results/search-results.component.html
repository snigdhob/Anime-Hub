<div class="container mt-5">
  <h3 class="mb-4" #searchResultsHeader>Search Results</h3>
  <div class="horizontal-flex-end" *ngIf="sortedData.length > 0">
    <pagination-controls
      (pageChange)="pageChanged($event)"
    ></pagination-controls>
  </div>
  <app-spinner-component
    #spinner
    name="searchResultsSpinner"
  ></app-spinner-component>

  <div class="table-responsive">
    <table class="table text-center" matSort (matSortChange)="sortData($event)">
      <tr class="table-header">
        <th mat-sort-header="title">Title</th>
        <th>Type</th>
        <th mat-sort-header="episodes">Episodes</th>
        <th mat-sort-header="score">Score</th>
      </tr>
      <ng-container *ngIf="sortedData.length > 0; else noRecords">
        <tr
          *ngFor="
            let item of sortedData
              | paginate
                : {
                    itemsPerPage: 25,
                    currentPage: pageNumber,
                    totalItems: totalResults,
                    autoHide: 'true'
                  }
          "
        >
          <td class="text-left">
            <div class="flex-style">
              <div class="mr-3">
                <ng-container
                  *ngIf="item.rated != 'Rx'; else imageNotAvailable"
                >
                  <img
                    [src]="item.images.webp.image_url"
                    height="100"
                    width="90"
                  />
                </ng-container>
                <ng-template #imageNotAvailable>
                  <img
                    src="../../assets/image-not-available.jpg"
                    height="100"
                    width="90"
                  />
                </ng-template>
              </div>

              <div class="anime-container">
                <a
                  href="javascript:void(0);"
                  class="anime-title"
                  [routerLink]="['/anime', item.mal_id, item.title, 'n']"
                >
                  {{ item.title }}
                </a>
                <div>
                  <ng-container
                    *ngIf="item.synopsis?.length > 200; else fullSynopsis"
                  >
                    {{ item.synopsis.slice(0, 250) }}...
                    <a
                      href="javascript:void(0);"
                      class="anime-title"
                      [routerLink]="['/anime', item.mal_id, item.title, 'n']"
                    >
                      read more.
                    </a>
                  </ng-container>
                  <ng-template #fullSynopsis>{{ item.synopsis }}</ng-template>
                </div>
              </div>
            </div>
          </td>
          <td>{{ item.type }}</td>
          <td>{{ item.episodes }}</td>
          <td>{{ item.score || "NA" }}</td>
        </tr>
      </ng-container>
      <ng-template #noRecords>
        <tr>
          <td colspan="4">No records found</td>
        </tr>
      </ng-template>
    </table>
  </div>

  <div class="horizontal-flex-end" *ngIf="sortedData.length > 0">
    <pagination-controls
      (pageChange)="pageChanged($event, true)"
    ></pagination-controls>
  </div>
</div>
